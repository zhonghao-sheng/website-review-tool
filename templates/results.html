<!DOCTYPE html>
<html>
<head>
    <title>Results</title>
    <script>
        // Assuming you have the job ID available in your template context
        const jobId = "{{ job_id }}";  // Pass the job ID from Django context

        window.addEventListener("beforeunload", function() {
            // Send a request to cancel the job before the user leaves the page
            fetch('/cancel_job/', { 
                method: 'POST',
                body: JSON.stringify({ job_id: jobId }),
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            // Optionally use sendBeacon for a non-blocking request (but can't add CSRF with sendBeacon)
            // navigator.sendBeacon('/cancel_job/', JSON.stringify({ job_id: jobId }));
        });
    </script>
</head>
<body>
    <h1>Search Results</h1>
    <ul>
        {% for result in results %}
            <li>{{ result }}</li>
        {% endfor %}
    </ul>
</body>
</html>
