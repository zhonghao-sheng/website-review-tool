{% comment %} <!DOCTYPE html>
<html>
<head>
    <title>Results</title>
    <script>
        function checkJobStatus(jobId) {
            fetch(`/search_link/job_status/${jobId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'finished') {
                        // Job is finished, reload the page to show results
                        window.location.reload();
                    } else if (data.status === 'failed') {
                        // Job failed, show error message
                        document.getElementById('status').innerText = 'Job failed.';
                    } else if (data.status === 'error') {
                        document.getElementById('status').innerText = `Error: ${data.message}`;
                    } else {
                        // Job is still running, check again after 1 second
                        setTimeout(() => checkJobStatus(jobId), 1000);
                    }
                })
                .catch(error => {
                    console.error('Error checking job status:', error);
                    document.getElementById('status').innerText = 'Error checking job status.';
                    setTimeout(() => checkJobStatus(jobId), 3000); // Check again after 3 seconds
                });
        }

        document.addEventListener('DOMContentLoaded', function() => {
            const jobId = '{{ job_id }}';
            checkJobStatus(jobId);
        });
    </script>
</head>
<body>
    {% if error %}
        <h1>An error occurred</h1>
        <p>{{ error }}</p>
    {% else %}
        <h1>Search Results</h1>
        <div id="status">Checking job status...</div>
        <ul>
            {% for result in results %}
                <li>{{ result }}</li>
            {% endfor %}
        </ul>
    {% endif %}
</body>
</html> {% endcomment %}


<!DOCTYPE html>
<html>
<head>
    <title>Results</title>
</head>
<body>
    {% if error %}
        <h1>An error occurred</h1>
        <p>{{ error }}</p>
    {% else %}
        <h1>Search Results</h1>
        <ul>
            {% for result in results %}
                <li>{{ result }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <script type="text/javascript">
        // Get the job_id from the template context or some other source
        const jobId = "{{ job_id }}";  // Pass job_id dynamically from your backend

        // Handle when the user leaves the page
        window.addEventListener("beforeunload", function() {
            // Notify the server that the user has left the page
            navigator.sendBeacon("/user_left/");

            // Send a request to cancel the job
            fetch('/cancel_job/', { 
                method: 'POST', 
                body: JSON.stringify({ job_id: jobId }),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
        });
    </script>
</body>
</html>
